<!doctype html>

<head>

<script src="/socket.io/socket.io.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>

<style>
.vertical-center {
    min-height: 100%;
    min-height: 100vh;

    display: flex;
    align-items: center;
}
</style>

</head>

<body>

<div class="container">
    <div class="row vertical-center text-center">
        <div class="col-md-8 col-md-offset-2 text-center">
            <h1>Control Panel</h1>
            <p><span id="status-connection" class="label label-danger">Not connected to server</span> <span id="status-displays" class="label label-warning">No displays connected to server</span></p>
            <button id="btn-reset-simulation" class="btn btn-default btn-lg">Reset Simulation</button>
        </div>
    </div>
</div>

<script>

function updateStatusConnected() {
    var statusElem = document.getElementById('status-connection');
    statusElem.innerHTML = 'Connected to server';
    statusElem.className = 'label label-success';
}
function updateStatusDisconnected() {
    var statusElem = document.getElementById('status-connection');
    statusElem.innerHTML = 'Not connected to server';
    statusElem.className = 'label label-danger';
}
function updateStatusMultipleConnected(numControlPanels) {
    var statusElem = document.getElementById('status-connection');
    statusElem.innerHTML = numControlPanels + ' control panels connected to server';
    statusElem.className = 'label label-info';
}
function updateStatusDisplaysConnected(numDisplays) {
    var statusElem = document.getElementById('status-displays');
    if (numDisplays > 1) {
        statusElem.innerHTML = numDisplays + ' displays connected to server';
    } else if (numDisplays === 1) {
        statusElem.innerHTML = 'Display connected to server';
    }
    statusElem.className = 'label label-success';
}
function updateStatusDisplaysDisconnected() {
    var statusElem = document.getElementById('status-displays');
    statusElem.innerHTML = 'No display connected to server';
    statusElem.className = 'label label-warning';
}

var socket = io.connect(window.location.host);
socket.on('connect', function(data) {
    socket.emit('connected', {client: 'control-panel'});
    console.log('Sockets: Connected to server.');
    updateStatusConnected();
});
socket.on('disconnect', function(data) {
    console.log('Sockets: Disconnected from server.');
    updateStatusDisconnected();
});
socket.on('control-connection-info', function(data) {
    if (data > 1) {
        updateStatusMultipleConnected(data);
    } else if (data == 1) {
        updateStatusConnected();
    }
});
socket.on('display-connection-info', function(data) {
    if (data > 0) {
        updateStatusDisplaysConnected(data);
    } else {
        updateStatusDisplaysDisconnected();
    }
});

document.getElementById('btn-reset-simulation').onclick = function() {
    console.log('Sockets: Resetting.');
    socket.emit('reset');
};

</script>

</body>
